# Test for various merge failure cases.

I definitions.inc

# --- Setup ---
> init
<<<
+ a.txt a.txt
> add a.txt
<<<
> commit "v1"
<<<
> branch dev
<<<

# Case 1: Failure - Uncommitted changes (staged additions).
+ b.txt b.txt
> add b.txt
<<<
> merge dev
You have uncommitted changes.
<<<
# The staging area should not be cleared.
# We can verify by trying to commit.
> commit "should succeed"
<<<

# Case 2: Failure - Uncommitted changes (staged removals).
> rm a.txt
<<<
> merge dev
You have uncommitted changes.
<<<

# Case 3: Failure - Merging a nonexistent branch.
> commit "remove a.txt"
<<<

> merge nonexistent-branch
A branch with that name does not exist.
<<<

# Case 4: Failure - Merging a branch with itself.
> merge master
Cannot merge a branch with itself.
<<<

# Case 5: Failure - Untracked file would be overwritten.
# dev branch does not have c.txt. Let's create it on master.
+ c.txt c.txt
> add c.txt
<<<
> commit "add c on master"
<<<
# Now go to dev and create an untracked b.txt
> checkout dev
<<<
* c.txt # c.txt should not be here
+ c.txt c_modified.txt
> merge master
There is an untracked file in the way; delete it, or add and commit it first.
<<<
# The untracked file should remain.
= c.txt c_modified.txt